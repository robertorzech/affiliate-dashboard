<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0d0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Partnerize">
<link rel="manifest" href="manifest.json">
<title>Partnerize Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #0a0c10;
    --surface: #111318;
    --surface2: #181b22;
    --border: #1f2330;
    --amber: #f5a623;
    --amber-dim: #7d5512;
    --green: #00e676;
    --red: #ff4444;
    --blue: #4fc3f7;
    --purple: #ce93d8;
    --text: #e8eaf0;
    --muted: #5a6070;
    --font-mono: 'Space Mono', monospace;
    --font-sans: 'Syne', sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-sans);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ GRID NOISE OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(245,166,35,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(245,166,35,0.02) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 24px 20px;
    position: relative;
    z-index: 1;
  }

  /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 36px;
    gap: 16px;
    flex-wrap: wrap;
  }

  .logo-area h1 {
    font-size: 1.8rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    color: var(--text);
  }

  .logo-area h1 span {
    color: var(--amber);
  }

  .logo-area p {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--muted);
    margin-top: 4px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .header-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  .status-dot {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--muted);
    padding: 6px 12px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: var(--surface);
  }

  .status-dot .dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--muted);
    transition: background 0.3s;
  }
  .status-dot.live .dot { background: var(--green); box-shadow: 0 0 8px var(--green); animation: pulse 2s infinite; }
  .status-dot.error .dot { background: var(--red); }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .btn {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface);
    color: var(--text);
  }
  .btn:hover { border-color: var(--amber); color: var(--amber); }
  .btn.primary {
    background: var(--amber);
    color: #000;
    border-color: var(--amber);
    font-weight: 700;
  }
  .btn.primary:hover { background: #ffbe4d; border-color: #ffbe4d; color: #000; }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* â”€â”€ SETUP PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #setup-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 32px;
    max-width: 540px;
    margin: 60px auto;
  }

  #setup-panel h2 {
    font-size: 1.3rem;
    font-weight: 800;
    margin-bottom: 6px;
  }

  #setup-panel p.subtitle {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--muted);
    margin-bottom: 28px;
    letter-spacing: 0.05em;
  }

  .form-group {
    margin-bottom: 18px;
  }

  .form-group label {
    display: block;
    font-family: var(--font-mono);
    font-size: 0.68rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .form-group input, .form-group select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px 14px;
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 0.82rem;
    transition: border-color 0.2s;
    outline: none;
  }

  .form-group input:focus, .form-group select:focus {
    border-color: var(--amber);
  }

  .form-group .hint {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--muted);
    margin-top: 5px;
  }

  .section-divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 24px 0;
  }

  .section-label {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--amber-dim);
    margin-bottom: 16px;
  }

  /* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #dashboard { display: none; }

  .refresh-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
    flex-wrap: wrap;
    gap: 12px;
  }

  .last-update {
    font-family: var(--font-mono);
    font-size: 0.68rem;
    color: var(--muted);
  }

  .refresh-controls {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .interval-select {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 10px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.68rem;
    outline: none;
    cursor: pointer;
  }

  /* â”€â”€ SUMMARY CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 14px;
    margin-bottom: 32px;
  }

  .status-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 18px 20px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s, transform 0.2s;
    cursor: default;
  }

  .status-card:hover { transform: translateY(-2px); }

  .status-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--card-accent, var(--muted));
  }

  .status-card .card-label {
    font-family: var(--font-mono);
    font-size: 0.62rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }

  .status-card .card-value {
    font-size: 1.7rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    color: var(--text);
    line-height: 1;
  }

  .status-card .card-count {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--muted);
    margin-top: 6px;
  }

  .status-card .change-badge {
    position: absolute;
    top: 14px; right: 14px;
    font-family: var(--font-mono);
    font-size: 0.6rem;
    padding: 2px 7px;
    border-radius: 3px;
    font-weight: 700;
    letter-spacing: 0.05em;
  }

  .change-badge.up { background: rgba(0,230,118,0.15); color: var(--green); }
  .change-badge.down { background: rgba(255,68,68,0.15); color: var(--red); }

  /* â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .section-title {
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 28px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: var(--font-mono);
    font-size: 0.77rem;
  }

  thead th {
    background: var(--surface2);
    padding: 11px 16px;
    text-align: left;
    font-size: 0.62rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }

  tbody td {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  tbody tr:last-child td { border-bottom: none; }
  tbody tr:hover td { background: rgba(245,166,35,0.03); }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 9px;
    border-radius: 3px;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }

  .badge-pending   { background: rgba(245,166,35,0.12); color: var(--amber); }
  .badge-approved  { background: rgba(0,230,118,0.12);  color: var(--green); }
  .badge-rejected  { background: rgba(255,68,68,0.12);  color: var(--red); }
  .badge-paid      { background: rgba(79,195,247,0.12); color: var(--blue); }
  .badge-new       { background: rgba(206,147,216,0.12); color: var(--purple); }
  .badge-other     { background: rgba(90,96,112,0.12); color: var(--muted); }

  /* â”€â”€ NOTIFICATION LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .notif-log {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 28px;
  }

  .notif-log-header {
    background: var(--surface2);
    padding: 11px 16px;
    font-family: var(--font-mono);
    font-size: 0.62rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
  }

  .notif-log-body {
    max-height: 220px;
    overflow-y: auto;
  }

  .notif-entry {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    font-family: var(--font-mono);
    font-size: 0.72rem;
    animation: slideIn 0.3s ease;
  }

  .notif-entry:last-child { border-bottom: none; }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  .notif-time {
    color: var(--muted);
    font-size: 0.65rem;
    white-space: nowrap;
    flex-shrink: 0;
    padding-top: 1px;
  }

  .notif-msg { color: var(--text); }
  .notif-empty {
    padding: 20px 16px;
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--muted);
    text-align: center;
  }

  /* â”€â”€ LOADING STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10,12,16,0.7);
    z-index: 100;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(4px);
  }

  .loading-overlay.show { display: flex; }

  .spinner {
    width: 40px; height: 40px;
    border: 2px solid var(--border);
    border-top-color: var(--amber);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--amber);
    padding: 14px 18px;
    border-radius: 6px;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    max-width: 340px;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 200;
  }

  #toast.show { transform: translateY(0); opacity: 1; }

  /* â”€â”€ SETTINGS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .settings-drawer {
    display: none;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 28px;
  }

  .settings-drawer.open { display: block; }

  .settings-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .settings-row .form-group { flex: 1; min-width: 200px; }

  /* â”€â”€ EMPTY / ERROR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .empty-state {
    text-align: center;
    padding: 40px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.78rem;
  }

  .error-msg {
    background: rgba(255,68,68,0.08);
    border: 1px solid rgba(255,68,68,0.2);
    border-radius: 6px;
    padding: 14px 18px;
    color: var(--red);
    font-family: var(--font-mono);
    font-size: 0.76rem;
    margin-bottom: 16px;
    display: none;
  }

  /* â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tab-nav {
    display: flex;
    gap: 4px;
    margin-bottom: 28px;
    border-bottom: 1px solid var(--border);
  }

  .tab-btn {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    padding: 10px 20px;
    border: none;
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    position: relative;
    top: 1px;
  }

  .tab-btn:hover { color: var(--text); }
  .tab-btn.active {
    color: var(--amber);
    border-bottom-color: var(--amber);
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  /* â”€â”€ ZEROPARK STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stat-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 24px 28px;
    position: relative;
    overflow: hidden;
  }

  .stat-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--blue), var(--purple));
  }

  .stat-label {
    font-family: var(--font-mono);
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
  }

  .stat-value {
    font-size: 2.4rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    color: var(--text);
    margin-bottom: 8px;
  }

  .stat-meta {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--muted);
  }

  .zp-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 18px;
    margin-bottom: 28px;
  }

  /* â”€â”€ AWIN STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .awin-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 28px;
  }

  .awin-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 20px 24px;
    position: relative;
  }

  .awin-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--card-color, var(--amber));
  }

  .awin-label {
    font-family: var(--font-mono);
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }

  .awin-value {
    font-size: 1.9rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    color: var(--text);
    margin-bottom: 6px;
  }

  .awin-meta {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--muted);
  }

  .proxy-note {
    background: rgba(79,195,247,0.06);
    border: 1px solid rgba(79,195,247,0.15);
    border-radius: 6px;
    padding: 12px 16px;
    color: var(--blue);
    font-family: var(--font-mono);
    font-size: 0.68rem;
    margin-top: 12px;
    line-height: 1.6;
  }

  /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 600px) {
    .summary-grid { grid-template-columns: 1fr 1fr; }
    .status-card .card-value { font-size: 1.3rem; }
    header { flex-direction: column; }
    table { font-size: 0.68rem; }
    thead th, tbody td { padding: 8px 10px; }
  }
</style>
</head>
<body>

<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
</div>

<div id="toast"></div>

<div class="container">
  <header>
    <div class="logo-area">
      <h1>Partner<span>ize</span> Monitor</h1>
      <p>Commission Status Dashboard</p>
    </div>
    <div class="header-actions">
      <div class="status-dot" id="conn-status">
        <span class="dot"></span>
        <span id="conn-label">Disconnected</span>
      </div>
      <button class="btn" onclick="openSettings()" id="settings-btn" style="display:none">âš™ Settings</button>
      <button class="btn" onclick="logout()" id="logout-btn" style="display:none">Logout</button>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETUP PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="setup-panel">
    <h2>Connect to APIs</h2>
    <p class="subtitle">// Konfiguracja poÅ‚Ä…czeÅ„</p>

    <div id="setup-error" class="error-msg"></div>

    <div class="section-label">// Partnerize API</div>

    <div class="form-group">
      <label>Application Key</label>
      <input type="text" id="pz-app-key" placeholder="TwÃ³j Application Key" autocomplete="off">
      <div class="hint">Znajdziesz w Settings â†’ Your Account</div>
    </div>

    <div class="form-group">
      <label>User API Key</label>
      <input type="password" id="api-key" placeholder="TwÃ³j User API Key" autocomplete="off">
      <div class="hint">Znajdziesz w Settings â†’ Your Account</div>
    </div>

    <div class="form-group">
      <label>Publisher ID</label>
      <input type="text" id="pz-publisher-id" placeholder="TwÃ³j Publisher ID">
      <div class="hint">Znajdziesz w Settings</div>
    </div>

    <div class="form-group">
      <label>Campaign ID (opcjonalnie)</label>
      <input type="text" id="campaign-id" placeholder="np. 1l100  â€” puste = wszystkie kampanie">
    </div>

    <hr class="section-divider">
    <div class="section-label">// Zeropark API</div>

    <div class="form-group">
      <label>API Token</label>
      <input type="password" id="zp-token" placeholder="TwÃ³j Zeropark API token" autocomplete="off">
      <div class="hint">Dashboard â†’ My Account â†’ Security â†’ Create API access token</div>
    </div>

    <hr class="section-divider">
    <div class="section-label">// Awin API</div>

    <div class="form-group">
      <label>OAuth2 Bearer Token</label>
      <input type="password" id="awin-token" placeholder="TwÃ³j Awin API token" autocomplete="off">
      <div class="hint">Wygeneruj w https://ui.awin.com/awin-api</div>
    </div>

    <div class="form-group">
      <label>Publisher ID</label>
      <input type="text" id="awin-publisher-id" placeholder="TwÃ³j Publisher ID">
      <div class="hint">Widoczny w Awin UI po zalogowaniu</div>
    </div>

    <hr class="section-divider">
    <div class="section-label">// Powiadomienia e-mail (opcjonalnie)</div>

    <div class="form-group">
      <label>EmailJS Service ID</label>
      <input type="text" id="emailjs-service" placeholder="service_xxxxxxx">
    </div>
    <div class="form-group">
      <label>EmailJS Template ID</label>
      <input type="text" id="emailjs-template" placeholder="template_xxxxxxx">
    </div>
    <div class="form-group">
      <label>EmailJS Public Key</label>
      <input type="text" id="emailjs-pubkey" placeholder="TwÃ³j Public Key z EmailJS">
    </div>
    <div class="form-group">
      <label>TwÃ³j adres e-mail (do powiadomieÅ„)</label>
      <input type="email" id="notify-email" placeholder="robert@example.com">
    </div>

    <div class="proxy-note">
      â„¹ï¸ Partnerize API nie wspiera CORS dla Å¼Ä…daÅ„ przeglÄ…darkowych. Aplikacja uÅ¼ywa proxy CORS (cors-anywhere). JeÅ›li napotkasz problem, uruchom aplikacjÄ™ lokalnie lub uÅ¼yj wÅ‚asnego proxy.
    </div>

    <br>
    <button class="btn primary" onclick="connectAPI()" style="width:100%">â†’ PoÅ‚Ä…cz i uruchom dashboard</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="dashboard">

    <!-- Tabs Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" onclick="switchTab('partnerize')">Partnerize</button>
      <button class="tab-btn" onclick="switchTab('zeropark')">Zeropark</button>
      <button class="tab-btn" onclick="switchTab('awin')">Awin</button>
    </div>

    <!-- â•â•â• PARTNERIZE TAB â•â•â• -->
    <div class="tab-content active" id="tab-partnerize">

    <!-- Settings drawer -->
    <div class="settings-drawer" id="settings-drawer">
      <div class="section-label">// Ustawienia API</div>
      <div class="settings-row">
        <div class="form-group">
          <label>Partnerize App Key</label>
          <input type="text" id="s-pz-app-key">
        </div>
        <div class="form-group">
          <label>Partnerize User API Key</label>
          <input type="password" id="s-pz-api-key">
        </div>
        <div class="form-group">
          <label>Partnerize Publisher ID</label>
          <input type="text" id="s-pz-pub-id">
        </div>
      </div>
      <div class="settings-row">
        <div class="form-group">
          <label>Zeropark API Token</label>
          <input type="password" id="s-zp-token">
        </div>
      </div>
      <div class="settings-row">
        <div class="form-group">
          <label>Awin OAuth2 Token</label>
          <input type="password" id="s-awin-token">
        </div>
        <div class="form-group">
          <label>Awin Publisher ID</label>
          <input type="text" id="s-awin-pubid">
        </div>
      </div>
      <hr class="section-divider">
      <div class="section-label">// Powiadomienia email</div>
      <div class="settings-row">
        <div class="form-group">
          <label>EmailJS Service ID</label>
          <input type="text" id="s-emailjs-service">
        </div>
        <div class="form-group">
          <label>EmailJS Template ID</label>
          <input type="text" id="s-emailjs-template">
        </div>
        <div class="form-group">
          <label>EmailJS Public Key</label>
          <input type="text" id="s-emailjs-pubkey">
        </div>
        <div class="form-group">
          <label>E-mail do powiadomieÅ„</label>
          <input type="email" id="s-notify-email">
        </div>
      </div>
      <button class="btn primary" onclick="saveSettings()">Zapisz ustawienia</button>
    </div>

    <div class="refresh-bar">
      <span class="last-update" id="last-update">Åadowanie...</span>
      <div class="refresh-controls">
        <select class="interval-select" id="refresh-interval" onchange="changeInterval()">
          <option value="60">OdÅ›wieÅ¼ co 1 min</option>
          <option value="300" selected>OdÅ›wieÅ¼ co 5 min</option>
          <option value="900">OdÅ›wieÅ¼ co 15 min</option>
          <option value="1800">OdÅ›wieÅ¼ co 30 min</option>
          <option value="0">WyÅ‚Ä…cz auto-odÅ›wieÅ¼anie</option>
        </select>
        <button class="btn" onclick="fetchData(true)">â†» OdÅ›wieÅ¼ teraz</button>
      </div>
    </div>

    <div id="dash-error" class="error-msg"></div>

    <!-- Summary cards -->
    <div class="summary-grid" id="summary-cards">
      <div class="empty-state" style="grid-column:1/-1">Pobieranie danych...</div>
    </div>

    <!-- Breakdown table -->
    <div class="section-header">
      <div class="section-title">SzczegÃ³Å‚y prowizji</div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Status</th>
            <th>Liczba</th>
            <th>WartoÅ›Ä‡ prowizji</th>
            <th>WartoÅ›Ä‡ sprzedaÅ¼y</th>
            <th>Waluta</th>
          </tr>
        </thead>
        <tbody id="detail-table">
          <tr><td colspan="5" class="empty-state">Åadowanie...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Notification log -->
    <div class="section-header">
      <div class="section-title">Log powiadomieÅ„</div>
      <button class="btn" onclick="clearLog()" style="font-size:0.65rem">WyczyÅ›Ä‡ log</button>
    </div>
    <div class="notif-log">
      <div class="notif-log-header">// Zmiany statusÃ³w</div>
      <div class="notif-log-body" id="notif-log">
        <div class="notif-empty">Brak zmian do wyÅ›wietlenia</div>
      </div>
    </div>

    </div> <!-- End Partnerize Tab -->

    <!-- â•â•â• ZEROPARK TAB â•â•â• -->
    <div class="tab-content" id="tab-zeropark">

    <div class="refresh-bar">
      <span class="last-update" id="zp-last-update">Åadowanie...</span>
      <div class="refresh-controls">
        <button class="btn" onclick="fetchZeroparkData(true)">â†» OdÅ›wieÅ¼</button>
      </div>
    </div>

    <div id="zp-error" class="error-msg"></div>

    <!-- Revenue Stats -->
    <div class="zp-grid">
      <div class="stat-box">
        <div class="stat-label">// PrzychÃ³d wczoraj</div>
        <div class="stat-value" id="zp-yesterday-revenue">â€”</div>
        <div class="stat-meta" id="zp-yesterday-meta">Pobieranie...</div>
      </div>

      <div class="stat-box">
        <div class="stat-label">// PrzychÃ³d w tym miesiÄ…cu</div>
        <div class="stat-value" id="zp-month-revenue">â€”</div>
        <div class="stat-meta" id="zp-month-meta">Pobieranie...</div>
      </div>
    </div>

    <!-- Details Table -->
    <div class="section-header">
      <div class="section-title">Podsumowanie</div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Okres</th>
            <th>Redirects</th>
            <th>Available Visits</th>
            <th>Conversions</th>
            <th>Payout (â‚¬)</th>
            <th>Profit (â‚¬)</th>
          </tr>
        </thead>
        <tbody id="zp-detail-table">
          <tr><td colspan="6" class="empty-state">Åadowanie...</td></tr>
        </tbody>
      </table>
    </div>

    </div> <!-- End Zeropark Tab -->

    <!-- â•â•â• AWIN TAB â•â•â• -->
    <div class="tab-content" id="tab-awin">

    <div class="refresh-bar">
      <span class="last-update" id="awin-last-update">Åadowanie...</span>
      <div class="refresh-controls">
        <button class="btn" onclick="fetchAwinData(true)">â†» OdÅ›wieÅ¼</button>
      </div>
    </div>

    <div id="awin-error" class="error-msg"></div>

    <!-- Summary Stats -->
    <div class="awin-summary">
      <div class="awin-card" style="--card-color: var(--blue)">
        <div class="awin-label">// Prowizje wczoraj</div>
        <div class="awin-value" id="awin-yesterday-commission">â€”</div>
        <div class="awin-meta" id="awin-yesterday-meta">Pobieranie...</div>
      </div>

      <div class="awin-card" style="--card-color: var(--purple)">
        <div class="awin-label">// Prowizje w tym miesiÄ…cu</div>
        <div class="awin-value" id="awin-month-commission">â€”</div>
        <div class="awin-meta" id="awin-month-meta">Pobieranie...</div>
      </div>

      <div class="awin-card" style="--card-color: var(--amber)">
        <div class="awin-label">// Pending prowizje</div>
        <div class="awin-value" id="awin-pending">â€”</div>
        <div class="awin-meta" id="awin-pending-meta">W oczekiwaniu</div>
      </div>

      <div class="awin-card" style="--card-color: var(--green)">
        <div class="awin-label">// Approved prowizje</div>
        <div class="awin-value" id="awin-approved">â€”</div>
        <div class="awin-meta" id="awin-approved-meta">Zatwierdzone</div>
      </div>
    </div>

    <!-- Breakdown by Status -->
    <div class="section-header">
      <div class="section-title">Prowizje wedÅ‚ug statusu (ten miesiÄ…c)</div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Status</th>
            <th>Liczba transakcji</th>
            <th>Prowizja</th>
            <th>SprzedaÅ¼</th>
          </tr>
        </thead>
        <tbody id="awin-status-table">
          <tr><td colspan="4" class="empty-state">Åadowanie...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Top Advertisers -->
    <div class="section-header">
      <div class="section-title">Top Advertisers (ten miesiÄ…c)</div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Advertiser</th>
            <th>Transakcje</th>
            <th>Prowizja</th>
            <th>SprzedaÅ¼</th>
          </tr>
        </thead>
        <tbody id="awin-advertisers-table">
          <tr><td colspan="4" class="empty-state">Åadowanie...</td></tr>
        </tbody>
      </table>
    </div>

    </div> <!-- End Awin Tab -->

  </div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROXY = 'https://corsproxy.io/?';
const BASE  = 'https://api.partnerize.com';
const ZP_BASE = 'https://panel.zeropark.com/api';
const AWIN_BASE = 'https://api.awin.com';

let config = {};
let prevData  = null;
let notifLog  = [];
let timer     = null;
let pushReady = false;
let zpData    = { yesterday: null, month: null };
let awinData  = { yesterday: [], month: [], byStatus: {}, byAdvertiser: {} };

// â”€â”€ Load saved config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadConfig() {
  const saved = localStorage.getItem('pz_config');
  if (saved) {
    config = JSON.parse(saved);
    return true;
  }
  return false;
}

function saveConfig(c) {
  config = { ...config, ...c };
  localStorage.setItem('pz_config', JSON.stringify(config));
}

// Load notification log
function loadLog() {
  const saved = localStorage.getItem('pz_log');
  if (saved) notifLog = JSON.parse(saved);
}

function saveLog() {
  localStorage.setItem('pz_log', JSON.stringify(notifLog.slice(0, 100)));
}

// â”€â”€ On page load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', async () => {
  loadLog();
  requestPushPermission();
  const hasPz = config.pzAppKey && config.apiKey && config.pzPubId;
  const hasZp = config.zpToken;
  const hasAwin = config.awinToken && config.awinPubId;
  const hasAnyApi = hasPz || hasZp || hasAwin;
  
  if (loadConfig() && hasAnyApi) {
    showDashboard();
    if (hasPz) await fetchData(false);
    if (hasZp) await fetchZeroparkData(false);
    if (hasAwin) await fetchAwinData(false);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PUSH NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function requestPushPermission() {
  if (!('Notification' in window)) return;
  if (Notification.permission === 'granted') { pushReady = true; return; }
  if (Notification.permission !== 'denied') {
    const p = await Notification.requestPermission();
    pushReady = (p === 'granted');
  }
}

function sendPush(title, body) {
  if (!pushReady) return;
  try {
    new Notification(title, { body, icon: 'icon-192.png' });
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EMAILJS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initEmailJS() {
  if (config.emailjsPubkey) {
    try { emailjs.init(config.emailjsPubkey); } catch(e) {}
  }
}

async function sendEmail(changes) {
  if (!config.emailjsService || !config.emailjsTemplate || !config.notifyEmail) return;
  const text = changes.map(c =>
    `Status: ${c.status}\nPoprzednio: ${c.old} â†’ Teraz: ${c.new}`
  ).join('\n\n');
  try {
    await emailjs.send(config.emailjsService, config.emailjsTemplate, {
      to_email: config.notifyEmail,
      subject: `[Partnerize] Zmiana statusu prowizji`,
      message: text,
      changes_html: changes.map(c =>
        `<b>${c.status}</b>: ${c.old} â†’ <b>${c.new}</b>`
      ).join('<br>')
    });
    addLog('ğŸ“§ Email z powiadomieniem wysÅ‚any na ' + config.notifyEmail);
  } catch(e) {
    addLog('âš ï¸ BÅ‚Ä…d wysyÅ‚ki emaila: ' + e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API CALLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function apiGet(endpoint) {
  // Partnerize uses HTTP Basic Auth: application_key:user_api_key
  const authString = config.pzAppKey + ':' + config.apiKey;
  const headers = {
    'Authorization': 'Basic ' + btoa(authString),
    'Accept': 'application/json'
  };
  const url = PROXY + encodeURIComponent(BASE + endpoint);
  const res = await fetch(url, { headers });
  if (!res.ok) {
    const txt = await res.text();
    throw new Error(`HTTP ${res.status}: ${txt.substring(0,200)}`);
  }
  return res.json();
}

// Fetch commission summary grouped by status
async function fetchCommissionSummary() {
  // Use conversions endpoint for publisher
  let endpoint = `/v1/partner/${config.pzPubId}/conversions`;
  
  // Get last 30 days
  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - 30);
  
  endpoint += `?start_date=${startDate.toISOString().split('T')[0]}`;
  endpoint += `&end_date=${endDate.toISOString().split('T')[0]}`;
  
  if (config.campaignId) endpoint += '&campaign_id=' + config.campaignId;

  try {
    const data = await apiGet(endpoint);
    return aggregateConversions(data);
  } catch(e) {
    throw e;
  }
}

function aggregateConversions(raw) {
  // Build a summary from conversions list
  const conversions = raw.conversions || raw.data || raw.items || [];
  const map = {};
  
  for (const c of conversions) {
    const status = c.conversion_status || c.status || 'unknown';
    const currency = c.publisher_commission_currency || c.currency || 'GBP';
    const key = status + '_' + currency;
    if (!map[key]) map[key] = { status, currency, count: 0, commission: 0, sale: 0 };
    map[key].count++;
    map[key].commission += parseFloat(c.publisher_commission || c.commission || 0);
    map[key].sale += parseFloat(c.sale_value || c.conversion_value || 0);
  }
  return { items: Object.values(map), source: 'conversions' };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONNECT & FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function connectAPI() {
  const pzAppKey  = document.getElementById('pz-app-key').value.trim();
  const apiKey     = document.getElementById('api-key').value.trim();
  const pzPubId    = document.getElementById('pz-publisher-id').value.trim();
  const campaignId = document.getElementById('campaign-id').value.trim();
  const zpToken    = document.getElementById('zp-token').value.trim();
  const awinToken  = document.getElementById('awin-token').value.trim();
  const awinPubId  = document.getElementById('awin-publisher-id').value.trim();
  const emailjsService  = document.getElementById('emailjs-service').value.trim();
  const emailjsTemplate = document.getElementById('emailjs-template').value.trim();
  const emailjsPubkey   = document.getElementById('emailjs-pubkey').value.trim();
  const notifyEmail     = document.getElementById('notify-email').value.trim();

  if (!apiKey && !zpToken && !awinToken) { 
    showError('setup-error', 'WprowadÅº co najmniej jeden klucz API'); 
    return; 
  }

  saveConfig({ 
    pzAppKey, apiKey, pzPubId, campaignId, zpToken, awinToken, awinPubId,
    emailjsService, emailjsTemplate, emailjsPubkey, notifyEmail 
  });
  initEmailJS();

  showLoading(true);
  try {
    if (pzAppKey && apiKey && pzPubId) await fetchData(false);
    if (zpToken) await fetchZeroparkData(false);
    if (awinToken && awinPubId) await fetchAwinData(false);
    showDashboard();
    requestPushPermission();
  } catch(e) {
    showError('setup-error', 'BÅ‚Ä…d poÅ‚Ä…czenia: ' + e.message);
    localStorage.removeItem('pz_config');
  } finally {
    showLoading(false);
  }
}

async function fetchData(manual = false) {
  showError('dash-error', '');
  try {
    const data = await fetchCommissionSummary();
    processData(data, manual);
    setConnStatus(true);
    document.getElementById('last-update').textContent =
      '// Ostatnia aktualizacja: ' + new Date().toLocaleTimeString('pl-PL');
  } catch(e) {
    setConnStatus(false);
    showError('dash-error', 'BÅ‚Ä…d pobierania danych: ' + e.message);
    if (manual) showToast('BÅ‚Ä…d: ' + e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA PROCESSING & CHANGE DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function processData(data, manual) {
  // Normalize to array of { status, currency, count, commission, sale }
  let items = [];

  if (data.items) {
    items = data.items;
  } else if (data.commissions) {
    items = normalizeFromCommissions(data.commissions);
  } else {
    // Try various API response shapes
    const flat = data.data || data.results || data.summary || [];
    items = flat.length ? flat : normalizeFromObject(data);
  }

  renderSummaryCards(items);
  renderTable(items);

  // Change detection
  const current = serializeState(items);
  if (prevData !== null && prevData !== current) {
    const changes = detectChanges(prevData, current, items);
    if (changes.length > 0) {
      notifyChanges(changes);
    }
  }
  prevData = current;
  localStorage.setItem('pz_prev', current);

  if (manual) showToast('Dane zaktualizowane pomyÅ›lnie');
}

function normalizeFromCommissions(arr) {
  const map = {};
  for (const c of arr) {
    const s  = c.status || 'unknown';
    const cu = c.currency || 'GBP';
    const k  = s + '_' + cu;
    if (!map[k]) map[k] = { status: s, currency: cu, count: 0, commission: 0, sale: 0 };
    map[k].count++;
    map[k].commission += parseFloat(c.commission || c.publisher_commission || 0);
    map[k].sale += parseFloat(c.sale_value || 0);
  }
  return Object.values(map);
}

function normalizeFromObject(obj) {
  // Last resort - try to find arrays inside object
  for (const key of Object.keys(obj)) {
    if (Array.isArray(obj[key]) && obj[key].length > 0) {
      return normalizeFromCommissions(obj[key]);
    }
  }
  return [];
}

function serializeState(items) {
  return JSON.stringify(
    items.map(i => ({
      status: i.status,
      currency: i.currency,
      commission: Math.round(parseFloat(i.commission || i.publisher_commission || 0) * 100),
      count: parseInt(i.count || i.num_conversions || 0)
    })).sort((a,b) => a.status.localeCompare(b.status))
  );
}

function detectChanges(prevStr, currStr, currentItems) {
  const prev = JSON.parse(prevStr);
  const curr = JSON.parse(currStr);
  const changes = [];

  const prevMap = Object.fromEntries(prev.map(p => [p.status + '_' + p.currency, p]));
  const currMap = Object.fromEntries(curr.map(c => [c.status + '_' + c.currency, c]));

  // Check for changed/new statuses
  for (const [key, c] of Object.entries(currMap)) {
    const p = prevMap[key];
    if (!p) {
      changes.push({ status: c.status + ' (' + c.currency + ')', old: '0', new: fmtVal(c.commission, c.currency) });
    } else if (p.commission !== c.commission) {
      changes.push({
        status: c.status + ' (' + c.currency + ')',
        old: fmtVal(p.commission / 100, c.currency),
        new: fmtVal(c.commission / 100, c.currency)
      });
    }
  }
  return changes;
}

async function notifyChanges(changes) {
  const summary = changes.map(c => `${c.status}: ${c.old} â†’ ${c.new}`).join(', ');
  addLog('ğŸ”” Zmiana prowizji: ' + summary);

  // Push notification
  const body = changes.map(c => `${c.status}: ${c.old} â†’ ${c.new}`).join('\n');
  sendPush('Partnerize â€“ zmiana prowizji', body);
  showToast('Zmiana statusu prowizji!');

  // Email
  await sendEmail(changes);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATUS_CONFIG = {
  pending:   { color: '#f5a623', label: 'OczekujÄ…ce' },
  approved:  { color: '#00e676', label: 'Zatwierdzone' },
  rejected:  { color: '#ff4444', label: 'Odrzucone' },
  paid:      { color: '#4fc3f7', label: 'WypÅ‚acone' },
  new:       { color: '#ce93d8', label: 'Nowe' },
  overdue:   { color: '#ff8a65', label: 'Przeterminowane' },
  cancelled: { color: '#b0bec5', label: 'Anulowane' },
};

function getStatusStyle(s) {
  return STATUS_CONFIG[s.toLowerCase()] || { color: '#5a6070', label: s };
}

function renderSummaryCards(items) {
  if (!items.length) {
    document.getElementById('summary-cards').innerHTML =
      '<div class="empty-state" style="grid-column:1/-1">Brak danych prowizji</div>';
    return;
  }

  // Restore prev for change badges
  const prevItems = prevData ? JSON.parse(prevData) : [];
  const prevMap = Object.fromEntries(prevItems.map(p => [p.status + '_' + p.currency, p]));

  const html = items.map(item => {
    const s = getStatusStyle(item.status);
    const val = parseFloat(item.commission || item.publisher_commission || 0);
    const cnt = parseInt(item.count || item.num_conversions || 0);
    const currency = item.currency || 'GBP';
    const key = item.status.toLowerCase() + '_' + currency;
    const prev = prevMap[key];

    let badge = '';
    if (prev) {
      const prevVal = prev.commission / 100;
      const diff = val - prevVal;
      if (Math.abs(diff) > 0.01) {
        const sign = diff > 0 ? '+' : '';
        badge = `<span class="change-badge ${diff > 0 ? 'up' : 'down'}">${sign}${fmtVal(diff, currency)}</span>`;
      }
    }

    return `
      <div class="status-card" style="--card-accent:${s.color}">
        ${badge}
        <div class="card-label">${s.label}</div>
        <div class="card-value">${fmtVal(val, currency)}</div>
        <div class="card-count">${cnt} transakcji</div>
      </div>`;
  }).join('');

  document.getElementById('summary-cards').innerHTML = html;
}

function renderTable(items) {
  if (!items.length) {
    document.getElementById('detail-table').innerHTML =
      '<tr><td colspan="5" class="empty-state">Brak danych</td></tr>';
    return;
  }

  const html = items.map(item => {
    const s = getStatusStyle(item.status);
    const badgeCls = 'badge-' + (STATUS_CONFIG[item.status.toLowerCase()] ? item.status.toLowerCase() : 'other');
    const val   = parseFloat(item.commission || item.publisher_commission || 0);
    const sale  = parseFloat(item.sale_value || item.sale || 0);
    const cnt   = parseInt(item.count || item.num_conversions || 0);
    const currency = item.currency || 'GBP';

    return `<tr>
      <td><span class="status-badge ${badgeCls}">â— ${s.label}</span></td>
      <td>${cnt.toLocaleString('pl-PL')}</td>
      <td><b>${fmtVal(val, currency)}</b></td>
      <td>${fmtVal(sale, currency)}</td>
      <td>${currency}</td>
    </tr>`;
  }).join('');

  document.getElementById('detail-table').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOG & NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addLog(msg) {
  notifLog.unshift({ time: new Date().toLocaleTimeString('pl-PL'), msg });
  saveLog();
  renderLog();
}

function renderLog() {
  const el = document.getElementById('notif-log');
  if (!notifLog.length) {
    el.innerHTML = '<div class="notif-empty">Brak zmian do wyÅ›wietlenia</div>';
    return;
  }
  el.innerHTML = notifLog.slice(0, 50).map(e =>
    `<div class="notif-entry">
      <span class="notif-time">${e.time}</span>
      <span class="notif-msg">${e.msg}</span>
    </div>`
  ).join('');
}

function clearLog() {
  notifLog = [];
  saveLog();
  renderLog();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO REFRESH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer(seconds) {
  if (timer) clearInterval(timer);
  if (seconds > 0) timer = setInterval(() => fetchData(false), seconds * 1000);
}

function changeInterval() {
  const val = parseInt(document.getElementById('refresh-interval').value);
  startTimer(val);
  addLog('â± Auto-odÅ›wieÅ¼anie zmienione: ' + (val ? val + 's' : 'wyÅ‚Ä…czone'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZEROPARK API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchZeroparkData(manual = false) {
  if (!config.zpToken) return;
  
  showError('zp-error', '');
  
  try {
    // Fetch yesterday
    const yesterdayData = await fetchZeroparkInterval('YESTERDAY');
    
    // Fetch this month
    const monthData = await fetchZeroparkInterval('THIS_MONTH');
    
    zpData.yesterday = yesterdayData;
    zpData.month = monthData;
    
    renderZeroparkData();
    
    document.getElementById('zp-last-update').textContent = 
      '// Ostatnia aktualizacja: ' + new Date().toLocaleTimeString('pl-PL');
    
    if (manual) showToast('Dane Zeropark zaktualizowane');
    
  } catch(e) {
    showError('zp-error', 'BÅ‚Ä…d pobierania Zeropark: ' + e.message);
    if (manual) showToast('BÅ‚Ä…d: ' + e.message);
  }
}

async function fetchZeroparkInterval(interval) {
  const url = `${ZP_BASE}/stats/campaign/all?interval=${interval}&page=0&limit=1`;
  const proxyUrl = PROXY + encodeURIComponent(url);
  
  try {
    const res = await fetch(proxyUrl, {
      headers: {
        'api-token': config.zpToken,
        'Accept': 'application/json'
      }
    });
    
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(`HTTP ${res.status}: ${txt.substring(0,200)}`);
    }
    
    const data = await res.json();
    
    // Return summary data
    return {
      spent: data.summary?.spent || 0,
      payout: data.summary?.payout || 0,
      profit: data.summary?.profit || 0,
      redirects: data.summary?.redirects || 0,
      conversions: data.summary?.conversions || 0,
      availableVisits: data.summary?.availableVisits || 0
    };
  } catch(e) {
    console.warn('Failed to fetch Zeropark data for', interval, e);
    throw e;
  }
}

function renderZeroparkData() {
  // Yesterday stats
  if (zpData.yesterday) {
    const y = zpData.yesterday;
    document.getElementById('zp-yesterday-revenue').textContent = 
      fmtMoney(y.payout);
    document.getElementById('zp-yesterday-meta').textContent = 
      `${y.conversions} conversions â€¢ ${y.redirects.toLocaleString('pl-PL')} redirects`;
  } else {
    document.getElementById('zp-yesterday-revenue').textContent = 'â‚¬0.00';
    document.getElementById('zp-yesterday-meta').textContent = 'Brak danych';
  }
  
  // Month stats
  if (zpData.month) {
    const m = zpData.month;
    document.getElementById('zp-month-revenue').textContent = 
      fmtMoney(m.payout);
    document.getElementById('zp-month-meta').textContent = 
      `${m.conversions} conversions â€¢ â‚¬${m.spent.toFixed(2)} spent â€¢ â‚¬${m.profit.toFixed(2)} profit`;
  } else {
    document.getElementById('zp-month-revenue').textContent = 'â‚¬0.00';
    document.getElementById('zp-month-meta').textContent = 'Brak danych';
  }
  
  // Table with detailed breakdown
  const tableData = [
    { label: 'Wczoraj', ...zpData.yesterday },
    { label: 'Ten miesiÄ…c', ...zpData.month }
  ];
  
  const html = tableData.map(d => `
    <tr>
      <td><b>${d.label}</b></td>
      <td>${d.redirects?.toLocaleString('pl-PL') || '0'}</td>
      <td>${d.availableVisits?.toLocaleString('pl-PL') || '0'}</td>
      <td>${d.conversions?.toLocaleString('pl-PL') || '0'}</td>
      <td><b>â‚¬${(d.payout || 0).toFixed(2)}</b></td>
      <td>${d.profit !== undefined ? 'â‚¬' + d.profit.toFixed(2) : 'â€”'}</td>
    </tr>
  `).join('');
  
  document.getElementById('zp-detail-table').innerHTML = html;
}

function formatDate(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

function formatDatePL(dateStr) {
  const [y, m, d] = dateStr.split('-');
  return `${d}.${m}.${y}`;
}

function fmtMoney(val) {
  return 'â‚¬' + val.toFixed(2);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AWIN API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchAwinData(manual = false) {
  if (!config.awinToken || !config.awinPubId) return;
  
  showError('awin-error', '');
  
  try {
    // Get yesterday's date
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayStart = formatDateTimeISO(new Date(yesterday.setHours(0,0,0,0)));
    const yesterdayEnd = formatDateTimeISO(new Date(yesterday.setHours(23,59,59,999)));
    
    // Get current month date range
    const now = new Date();
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthStartISO = formatDateTimeISO(new Date(monthStart.setHours(0,0,0,0)));
    const monthEndISO = formatDateTimeISO(new Date(now.setHours(23,59,59,999)));
    
    // Fetch yesterday's transactions
    const yesterdayTxns = await fetchAwinTransactions(yesterdayStart, yesterdayEnd);
    
    // Fetch this month's transactions
    const monthTxns = await fetchAwinTransactions(monthStartISO, monthEndISO);
    
    awinData.yesterday = yesterdayTxns;
    awinData.month = monthTxns;
    
    // Process data by status
    awinData.byStatus = aggregateByStatus(monthTxns);
    awinData.byAdvertiser = aggregateByAdvertiser(monthTxns);
    
    renderAwinData();
    
    document.getElementById('awin-last-update').textContent = 
      '// Ostatnia aktualizacja: ' + new Date().toLocaleTimeString('pl-PL');
    
    if (manual) showToast('Dane Awin zaktualizowane');
    
  } catch(e) {
    showError('awin-error', 'BÅ‚Ä…d pobierania Awin: ' + e.message);
    if (manual) showToast('BÅ‚Ä…d: ' + e.message);
  }
}

async function fetchAwinTransactions(startDate, endDate) {
  const url = `${AWIN_BASE}/publishers/${config.awinPubId}/transactions/?startDate=${startDate}&endDate=${endDate}&timezone=UTC`;
  const proxyUrl = PROXY + encodeURIComponent(url);
  
  const headers = {
    'Authorization': 'Bearer ' + config.awinToken,
    'Accept': 'application/json'
  };
  
  try {
    const res = await fetch(proxyUrl, { 
      headers: {
        'Authorization': 'Bearer ' + config.awinToken
      }
    });
    
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(`HTTP ${res.status}: ${txt.substring(0,200)}`);
    }
    
    const data = await res.json();
    return data || [];
  } catch(e) {
    console.warn('Failed to fetch Awin transactions', e);
    throw e;
  }
}

function aggregateByStatus(transactions) {
  const map = {};
  
  for (const txn of transactions) {
    const status = txn.commissionStatus || 'unknown';
    const currency = txn.commissionAmount?.currency || 'GBP';
    const key = status + '_' + currency;
    
    if (!map[key]) {
      map[key] = {
        status,
        currency,
        count: 0,
        commission: 0,
        sale: 0
      };
    }
    
    map[key].count++;
    map[key].commission += parseFloat(txn.commissionAmount?.amount || 0);
    map[key].sale += parseFloat(txn.saleAmount?.amount || 0);
  }
  
  return Object.values(map);
}

function aggregateByAdvertiser(transactions) {
  const map = {};
  
  for (const txn of transactions) {
    const advId = txn.advertiserId || 'unknown';
    const advName = txn.advertiserName || txn.campaign || `Advertiser ${advId}`;
    const currency = txn.commissionAmount?.currency || 'GBP';
    
    if (!map[advId]) {
      map[advId] = {
        id: advId,
        name: advName,
        currency,
        count: 0,
        commission: 0,
        sale: 0
      };
    }
    
    map[advId].count++;
    map[advId].commission += parseFloat(txn.commissionAmount?.amount || 0);
    map[advId].sale += parseFloat(txn.saleAmount?.amount || 0);
  }
  
  // Sort by commission descending
  return Object.values(map).sort((a, b) => b.commission - a.commission);
}

function renderAwinData() {
  // Yesterday stats
  const yesterdayCommission = awinData.yesterday.reduce((sum, t) => 
    sum + parseFloat(t.commissionAmount?.amount || 0), 0
  );
  const yesterdayCount = awinData.yesterday.length;
  
  document.getElementById('awin-yesterday-commission').textContent = 
    fmtCurrency(yesterdayCommission, awinData.yesterday[0]?.commissionAmount?.currency || 'GBP');
  document.getElementById('awin-yesterday-meta').textContent = 
    `${yesterdayCount} transakcji`;
  
  // Month stats
  const monthCommission = awinData.month.reduce((sum, t) => 
    sum + parseFloat(t.commissionAmount?.amount || 0), 0
  );
  const monthSale = awinData.month.reduce((sum, t) => 
    sum + parseFloat(t.saleAmount?.amount || 0), 0
  );
  const monthCount = awinData.month.length;
  
  document.getElementById('awin-month-commission').textContent = 
    fmtCurrency(monthCommission, awinData.month[0]?.commissionAmount?.currency || 'GBP');
  document.getElementById('awin-month-meta').textContent = 
    `${monthCount} transakcji â€¢ ${fmtCurrency(monthSale, awinData.month[0]?.saleAmount?.currency || 'GBP')} sprzedaÅ¼`;
  
  // Pending
  const pending = awinData.month.filter(t => t.commissionStatus === 'pending');
  const pendingCommission = pending.reduce((sum, t) => 
    sum + parseFloat(t.commissionAmount?.amount || 0), 0
  );
  document.getElementById('awin-pending').textContent = 
    fmtCurrency(pendingCommission, pending[0]?.commissionAmount?.currency || 'GBP');
  document.getElementById('awin-pending-meta').textContent = 
    `${pending.length} transakcji`;
  
  // Approved
  const approved = awinData.month.filter(t => t.commissionStatus === 'approved');
  const approvedCommission = approved.reduce((sum, t) => 
    sum + parseFloat(t.commissionAmount?.amount || 0), 0
  );
  document.getElementById('awin-approved').textContent = 
    fmtCurrency(approvedCommission, approved[0]?.commissionAmount?.currency || 'GBP');
  document.getElementById('awin-approved-meta').textContent = 
    `${approved.length} transakcji`;
  
  // Status table
  if (awinData.byStatus.length === 0) {
    document.getElementById('awin-status-table').innerHTML = 
      '<tr><td colspan="4" class="empty-state">Brak danych</td></tr>';
  } else {
    const statusHtml = awinData.byStatus.map(s => `
      <tr>
        <td><span class="status-badge badge-${s.status.toLowerCase()}">${s.status.toUpperCase()}</span></td>
        <td>${s.count.toLocaleString('pl-PL')}</td>
        <td><b>${fmtCurrency(s.commission, s.currency)}</b></td>
        <td>${fmtCurrency(s.sale, s.currency)}</td>
      </tr>
    `).join('');
    document.getElementById('awin-status-table').innerHTML = statusHtml;
  }
  
  // Advertisers table
  if (awinData.byAdvertiser.length === 0) {
    document.getElementById('awin-advertisers-table').innerHTML = 
      '<tr><td colspan="4" class="empty-state">Brak danych</td></tr>';
  } else {
    const advHtml = awinData.byAdvertiser.slice(0, 10).map(a => `
      <tr>
        <td>${a.name}</td>
        <td>${a.count.toLocaleString('pl-PL')}</td>
        <td><b>${fmtCurrency(a.commission, a.currency)}</b></td>
        <td>${fmtCurrency(a.sale, a.currency)}</td>
      </tr>
    `).join('');
    document.getElementById('awin-advertisers-table').innerHTML = advHtml;
  }
}

function formatDateTimeISO(date) {
  return date.toISOString().split('.')[0];
}

function fmtCurrency(val, currency) {
  return new Intl.NumberFormat('pl-PL', {
    style: 'currency',
    currency: currency || 'GBP',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(val);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update tab content
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  document.getElementById('tab-' + tab).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDashboard() {
  document.getElementById('setup-panel').style.display = 'none';
  document.getElementById('dashboard').style.display   = 'block';
  document.getElementById('settings-btn').style.display = 'inline-flex';
  document.getElementById('logout-btn').style.display   = 'inline-flex';
  initEmailJS();
  renderLog();
  startTimer(300); // default 5min

  // restore prev state
  const saved = localStorage.getItem('pz_prev');
  if (saved) prevData = saved;

  // populate settings drawer
  document.getElementById('s-pz-app-key').value       = config.pzAppKey || '';
  document.getElementById('s-pz-api-key').value       = config.apiKey || '';
  document.getElementById('s-pz-pub-id').value        = config.pzPubId || '';
  document.getElementById('s-zp-token').value         = config.zpToken || '';
  document.getElementById('s-awin-token').value       = config.awinToken || '';
  document.getElementById('s-awin-pubid').value       = config.awinPubId || '';
  document.getElementById('s-emailjs-service').value  = config.emailjsService || '';
  document.getElementById('s-emailjs-template').value = config.emailjsTemplate || '';
  document.getElementById('s-emailjs-pubkey').value   = config.emailjsPubkey || '';
  document.getElementById('s-notify-email').value     = config.notifyEmail || '';
  
  // Load data if configured
  if (config.pzAppKey && config.apiKey && config.pzPubId) {
    fetchData(false);
  }
  if (config.zpToken) {
    fetchZeroparkData(false);
  }
  if (config.awinToken && config.awinPubId) {
    fetchAwinData(false);
  }
}

function openSettings() {
  document.getElementById('settings-drawer').classList.toggle('open');
}

function saveSettings() {
  saveConfig({
    pzAppKey:        document.getElementById('s-pz-app-key').value.trim(),
    apiKey:          document.getElementById('s-pz-api-key').value.trim(),
    pzPubId:         document.getElementById('s-pz-pub-id').value.trim(),
    zpToken:         document.getElementById('s-zp-token').value.trim(),
    awinToken:       document.getElementById('s-awin-token').value.trim(),
    awinPubId:       document.getElementById('s-awin-pubid').value.trim(),
    emailjsService:  document.getElementById('s-emailjs-service').value.trim(),
    emailjsTemplate: document.getElementById('s-emailjs-template').value.trim(),
    emailjsPubkey:   document.getElementById('s-emailjs-pubkey').value.trim(),
    notifyEmail:     document.getElementById('s-notify-email').value.trim()
  });
  initEmailJS();
  document.getElementById('settings-drawer').classList.remove('open');
  showToast('Ustawienia zapisane');
  
  // Reload data if credentials changed
  if (config.pzAppKey && config.apiKey && config.pzPubId) {
    fetchData(false);
  }
  if (config.zpToken) {
    fetchZeroparkData(false);
  }
  if (config.awinToken && config.awinPubId) {
    fetchAwinData(false);
  }
}

function logout() {
  localStorage.removeItem('pz_config');
  localStorage.removeItem('pz_prev');
  if (timer) clearInterval(timer);
  location.reload();
}

function setConnStatus(ok) {
  const el = document.getElementById('conn-status');
  el.className = 'status-dot ' + (ok ? 'live' : 'error');
  document.getElementById('conn-label').textContent = ok ? 'Live' : 'Error';
}

function showError(id, msg) {
  const el = document.getElementById(id);
  if (!el) return;
  el.style.display = msg ? 'block' : 'none';
  el.textContent = msg;
}

function showLoading(v) {
  document.getElementById('loading').className = 'loading-overlay' + (v ? ' show' : '');
}

let toastTimer;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 3500);
}

function fmtVal(val, currency) {
  return new Intl.NumberFormat('pl-PL', {
    style: 'currency', currency: currency || 'GBP',
    minimumFractionDigits: 2, maximumFractionDigits: 2
  }).format(val);
}
</script>
</body>
</html>
